2025-09-20 14:35:11,383 - machine_control - INFO - ALD Control System starting via CLI
2025-09-20 14:35:11,383 - machine_control - INFO - Effective Config -> PLC: real, IP: -, Port: -, Hostname: plc.local, Auto-discover: true, LogLevel: INFO, LogFile: machine_control.log
2025-09-20 14:35:11,485 - machine_control - INFO - Starting machine control application
2025-09-20 14:35:11,485 - machine_control - INFO - Attempting initial PLC connection...
2025-09-20 14:35:11,485 - machine_control - INFO - Initializing PLC of type real
2025-09-20 14:35:11,485 - machine_control - INFO - Creating real PLC connection
2025-09-20 14:35:11,485 - machine_control - INFO - PLC connection config - IP: 10.5.5.80, Port: 502, Hostname: plc.local, Auto-discover: True
2025-09-20 14:35:11,494 - machine_control - INFO - Using byte order: badc
2025-09-20 14:35:11,494 - machine_control - INFO - Hostname resolution enabled: plc.local
2025-09-20 14:35:11,494 - machine_control - INFO - Auto-discovery enabled for DHCP environments
2025-09-20 14:35:11,494 - machine_control - INFO - Connecting to real PLC at 10.5.5.80:502
2025-09-20 14:35:11,494 - machine_control - INFO - Attempting hostname resolution: plc.local
2025-09-20 14:35:11,494 - machine_control - INFO - Attempting auto-discovery...
Connection to (plc.local, 502) failed: [Errno 8] nodename nor servname provided, or not known
Connection to (plc.local, 502) failed: [Errno 8] nodename nor servname provided, or not known
Connection to (plc.local, 502) failed: [Errno 8] nodename nor servname provided, or not known
2025-09-20 14:35:28,515 - machine_control - ERROR - Failed to connect to PLC at plc.local via hostname after 3 attempts
Connection to (10.5.5.80, 502) failed: timed out
Connection to (10.5.5.80, 502) failed: [Errno 64] Host is down
Connection to (10.5.5.80, 502) failed: [Errno 64] Host is down
2025-09-20 14:35:40,528 - machine_control - ERROR - Failed to connect to PLC at 10.5.5.80 via static after 3 attempts
2025-09-20 14:35:40,528 - machine_control - ERROR - All connection attempts failed
2025-09-20 14:35:40,528 - machine_control - ERROR - Failed to connect to PLC
2025-09-20 14:35:40,528 - machine_control - ERROR - Error initializing PLC: Failed to initialize real PLC
Traceback (most recent call last):
  File "/Users/albaraa/ald-control-system-phase-5/src/plc/manager.py", line 52, in initialize
    self._plc = await PLCFactory.create_plc(plc_type, config)
  File "/Users/albaraa/ald-control-system-phase-5/src/plc/factory.py", line 55, in create_plc
    raise RuntimeError(f"Failed to initialize {plc_type} PLC")
RuntimeError: Failed to initialize real PLC
2025-09-20 14:35:40,537 - machine_control - INFO - Received interrupt signal, initiating cleanup...
2025-09-20 14:35:40,537 - machine_control - INFO - Beginning cleanup process...
2025-09-20 14:35:40,537 - machine_control - INFO - Initializing Supabase client with URL: https://yceyfsqusdmcwgkwxcnt.supabase.co
2025-09-20 14:35:40,537 - machine_control - INFO - API Key (first 10 chars): eyJhbGciOi...
2025-09-20 14:35:40,585 - machine_control - INFO - Supabase client initialized successfully
2025-09-20 14:35:40,856 - machine_control - INFO - Application shutdown complete
2025-09-20 14:35:40,856 - machine_control - WARNING - ⚠️ PLC not connected, will retry in background
2025-09-20 14:35:40,856 - machine_control - INFO - Service starting with PLC connected: False
2025-09-20 14:35:40,856 - machine_control - INFO - Starting connection monitor...
2025-09-20 14:35:40,856 - machine_control - INFO - Starting connection monitor...
2025-09-20 14:35:40,856 - machine_control - INFO - Connection monitor started
2025-09-20 14:35:40,856 - machine_control - INFO - Creating async Supabase client...
2025-09-20 14:35:40,856 - machine_control - INFO - Initializing async Supabase client with URL: https://yceyfsqusdmcwgkwxcnt.supabase.co
2025-09-20 14:35:40,856 - machine_control - INFO - API Key (first 10 chars): eyJhbGciOi...
2025-09-20 14:35:40,859 - machine_control - INFO - Async Supabase client initialized successfully
2025-09-20 14:35:40,859 - machine_control - INFO - Setting up command listener...
2025-09-20 14:35:40,859 - machine_control - INFO - Subscribing to INSERT events on recipe_commands table...
2025-09-20 14:35:40,861 - machine_control - INFO - Attempting PLC reconnection (attempt 1/5)...
2025-09-20 14:35:40,861 - machine_control - INFO - Initializing PLC of type real
2025-09-20 14:35:40,861 - machine_control - INFO - Creating real PLC connection
2025-09-20 14:35:40,861 - machine_control - INFO - PLC connection config - IP: 10.5.5.80, Port: 502, Hostname: plc.local, Auto-discover: True
2025-09-20 14:35:40,861 - machine_control - INFO - Using byte order: badc
2025-09-20 14:35:40,861 - machine_control - INFO - Hostname resolution enabled: plc.local
2025-09-20 14:35:40,861 - machine_control - INFO - Auto-discovery enabled for DHCP environments
2025-09-20 14:35:40,861 - machine_control - INFO - Connecting to real PLC at 10.5.5.80:502
2025-09-20 14:35:40,861 - machine_control - INFO - Attempting hostname resolution: plc.local
2025-09-20 14:35:40,861 - machine_control - INFO - Attempting auto-discovery...
Connection to (plc.local, 502) failed: [Errno 8] nodename nor servname provided, or not known
Connection to (plc.local, 502) failed: [Errno 8] nodename nor servname provided, or not known
Connection to (plc.local, 502) failed: [Errno 8] nodename nor servname provided, or not known
2025-09-20 14:35:57,878 - machine_control - ERROR - Failed to connect to PLC at plc.local via hostname after 3 attempts
Connection to (10.5.5.80, 502) failed: timed out
Connection to (10.5.5.80, 502) failed: [Errno 64] Host is down
Connection to (10.5.5.80, 502) failed: [Errno 64] Host is down
2025-09-20 14:36:09,892 - machine_control - ERROR - Failed to connect to PLC at 10.5.5.80 via static after 3 attempts
2025-09-20 14:36:09,893 - machine_control - ERROR - All connection attempts failed
2025-09-20 14:36:09,893 - machine_control - ERROR - Failed to connect to PLC
2025-09-20 14:36:09,893 - machine_control - ERROR - Error initializing PLC: Failed to initialize real PLC
Traceback (most recent call last):
  File "/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/runners.py", line 44, in run
    return loop.run_until_complete(main)
  File "/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py", line 629, in run_until_complete
    self.run_forever()
  File "/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py", line 596, in run_forever
    self._run_once()
  File "/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py", line 1890, in _run_once
    handle._run()
  File "/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
  File "/Users/albaraa/ald-control-system-phase-5/src/main.py", line 66, in signal_handler
    await cleanup_handler()
  File "/Users/albaraa/ald-control-system-phase-5/src/main.py", line 61, in cleanup_handler
    sys.exit(0)
SystemExit: 0

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/albaraa/ald-control-system-phase-5/src/plc/manager.py", line 52, in initialize
    self._plc = await PLCFactory.create_plc(plc_type, config)
  File "/Users/albaraa/ald-control-system-phase-5/src/plc/factory.py", line 55, in create_plc
    raise RuntimeError(f"Failed to initialize {plc_type} PLC")
RuntimeError: Failed to initialize real PLC
2025-09-20 14:36:11,796 - machine_control - INFO - Successfully subscribed to recipe_commands table
2025-09-20 14:36:11,796 - machine_control - INFO - Checking for existing pending commands...
2025-09-20 14:36:11,913 - machine_control - INFO - No pending commands found
2025-09-20 14:36:11,913 - machine_control - INFO - Checked for existing pending commands
2025-09-20 14:36:11,913 - machine_control - INFO - Starting command polling as a fallback mechanism
2025-09-20 14:36:11,914 - machine_control - INFO - Setting up parameter control listener with realtime support...
2025-09-20 14:36:11,914 - machine_control - INFO - Setting up realtime subscriptions for parameter_control_commands table...
2025-09-20 14:36:11,914 - machine_control - INFO - Subscribing to realtime channel...
2025-09-20 14:36:11,914 - machine_control - INFO - Successfully subscribed to realtime channel: parameter-control-commands-e3e6e280-0794-459f-84d5-5e468f60746e
2025-09-20 14:36:11,914 - machine_control - INFO - Starting realtime connection monitor
2025-09-20 14:36:11,914 - machine_control - INFO - Checking for existing pending parameter control commands...
2025-09-20 14:36:11,914 - machine_control - INFO - Checking for existing pending parameter control commands...
2025-09-20 14:36:12,027 - machine_control - INFO - Started parameter control command polling as fallback mechanism
2025-09-20 14:36:12,027 - machine_control - INFO - ✅ Parameter control listener ready with REALTIME + polling fallback
2025-09-20 14:36:12,027 - machine_control - INFO - Machine control application running
2025-09-20 14:36:12,027 - machine_control - INFO - ============================================================
2025-09-20 14:36:12,027 - machine_control - INFO - System Status:
2025-09-20 14:36:12,027 - machine_control - INFO -   - PLC Connection: ❌ Disconnected
2025-09-20 14:36:12,027 - machine_control - INFO -   - Realtime Channels: ✅ Active
2025-09-20 14:36:12,027 - machine_control - INFO -   - Machine ID: e3e6e280-0794-459f-84d5-5e468f60746e
2025-09-20 14:36:12,027 - machine_control - INFO - ============================================================
2025-09-20 14:36:12,027 - machine_control - INFO - Service is ready to receive commands
2025-09-20 14:36:12,027 - machine_control - INFO - Checking for existing pending commands...
2025-09-20 14:36:12,148 - machine_control - INFO - No pending commands found
2025-09-20 14:36:12,148 - machine_control - INFO - Starting parameter command polling (interval: 10s, realtime: True)
2025-09-20 14:36:12,148 - machine_control - INFO - Checking for existing pending parameter control commands...
2025-09-20 14:36:17,150 - machine_control - INFO - Checking for existing pending commands...
2025-09-20 14:36:17,263 - machine_control - INFO - No pending commands found
2025-09-20 14:36:22,265 - machine_control - INFO - Checking for existing pending commands...
2025-09-20 14:36:22,544 - machine_control - INFO - No pending commands found
2025-09-20 14:36:27,546 - machine_control - INFO - Checking for existing pending commands...
2025-09-20 14:36:27,796 - machine_control - INFO - No pending commands found
2025-09-20 14:36:32,797 - machine_control - INFO - Checking for existing pending commands...
2025-09-20 14:36:33,044 - machine_control - INFO - No pending commands found
2025-09-20 14:36:38,045 - machine_control - INFO - Checking for existing pending commands...
2025-09-20 14:36:38,291 - machine_control - INFO - No pending commands found
2025-09-20 14:36:43,293 - machine_control - INFO - Checking for existing pending commands...
2025-09-20 14:36:43,564 - machine_control - INFO - No pending commands found
2025-09-20 14:36:48,566 - machine_control - INFO - Checking for existing pending commands...
2025-09-20 14:36:48,812 - machine_control - INFO - No pending commands found
2025-09-20 14:36:49,901 - machine_control - INFO - Attempting PLC reconnection (attempt 2/5)...
2025-09-20 14:36:49,902 - machine_control - INFO - Initializing PLC of type real
2025-09-20 14:36:49,902 - machine_control - INFO - Creating real PLC connection
2025-09-20 14:36:49,902 - machine_control - INFO - PLC connection config - IP: 10.5.5.80, Port: 502, Hostname: plc.local, Auto-discover: True
2025-09-20 14:36:49,902 - machine_control - INFO - Using byte order: badc
2025-09-20 14:36:49,902 - machine_control - INFO - Hostname resolution enabled: plc.local
2025-09-20 14:36:49,902 - machine_control - INFO - Auto-discovery enabled for DHCP environments
2025-09-20 14:36:49,902 - machine_control - INFO - Connecting to real PLC at 10.5.5.80:502
2025-09-20 14:36:49,902 - machine_control - INFO - Attempting hostname resolution: plc.local
2025-09-20 14:36:49,902 - machine_control - INFO - Attempting auto-discovery...
Connection to (plc.local, 502) failed: [Errno 8] nodename nor servname provided, or not known
Connection to (plc.local, 502) failed: [Errno 8] nodename nor servname provided, or not known
Connection to (plc.local, 502) failed: [Errno 8] nodename nor servname provided, or not known
2025-09-20 14:37:06,918 - machine_control - ERROR - Failed to connect to PLC at plc.local via hostname after 3 attempts
Connection to (10.5.5.80, 502) failed: timed out
Connection to (10.5.5.80, 502) failed: [Errno 64] Host is down
Connection to (10.5.5.80, 502) failed: [Errno 64] Host is down
2025-09-20 14:37:18,930 - machine_control - ERROR - Failed to connect to PLC at 10.5.5.80 via static after 3 attempts
2025-09-20 14:37:18,930 - machine_control - ERROR - All connection attempts failed
2025-09-20 14:37:18,931 - machine_control - ERROR - Failed to connect to PLC
2025-09-20 14:37:18,931 - machine_control - ERROR - Error initializing PLC: Failed to initialize real PLC
Traceback (most recent call last):
  File "/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/runners.py", line 44, in run
    return loop.run_until_complete(main)
  File "/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py", line 629, in run_until_complete
    self.run_forever()
  File "/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py", line 596, in run_forever
    self._run_once()
  File "/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py", line 1890, in _run_once
    handle._run()
  File "/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
  File "/Users/albaraa/ald-control-system-phase-5/src/main.py", line 66, in signal_handler
    await cleanup_handler()
  File "/Users/albaraa/ald-control-system-phase-5/src/main.py", line 61, in cleanup_handler
    sys.exit(0)
SystemExit: 0

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/albaraa/ald-control-system-phase-5/src/plc/manager.py", line 52, in initialize
    self._plc = await PLCFactory.create_plc(plc_type, config)
  File "/Users/albaraa/ald-control-system-phase-5/src/plc/factory.py", line 55, in create_plc
    raise RuntimeError(f"Failed to initialize {plc_type} PLC")
RuntimeError: Failed to initialize real PLC
2025-09-20 14:37:18,931 - machine_control - INFO - Checking for existing pending commands...
2025-09-20 14:37:19,234 - machine_control - INFO - No pending commands found
2025-09-20 14:37:24,235 - machine_control - INFO - Checking for existing pending commands...
2025-09-20 14:37:24,370 - machine_control - INFO - No pending commands found
