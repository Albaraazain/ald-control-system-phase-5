{"timestamp": "2025-09-20T14:40:48.018141", "agent_id": "investigator-143806-c91977", "finding_type": "issue", "severity": "high", "message": "Import-time hard validation in src/config.py raised ValueError on missing SUPABASE_URL/KEY/MACHINE_ID, causing `--doctor` to crash before tests ran.", "data": {"file": "src/config.py: lines 21-33 (pre-patch)", "impact": "Doctor path and any PLC-only tools failed without Supabase env.", "repro": "mv .env .env.bak && python main.py --doctor -> ValueError during import"}}
{"timestamp": "2025-09-20T14:40:55.544391", "agent_id": "investigator-143806-c91977", "finding_type": "solution", "severity": "high", "message": "Refactored config/db to support doctor mode gracefully and keep strong validation at use sites.", "data": {"patches": [{"file": "src/config.py", "summary": "Removed import-time raises; added helpers: missing_required_keys(), is_supabase_config_present(), is_core_config_ready()."}, {"file": "src/db.py", "summary": "Guard against missing SUPABASE_* before logging/slicing; raise clear ValueError if missing in get_supabase()/create_async_supabase()."}, {"file": "main.py", "summary": "Set DOCTOR_MODE=true when running --doctor (non-breaking; available for future conditional behavior)."}], "behavior_change": "`python main.py --doctor` no longer crashes on import when Supabase envs are absent; Supabase tests report failures cleanly and PLC tests still run."}}
