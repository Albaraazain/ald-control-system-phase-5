{"timestamp": "2025-09-20T19:58:22.402603", "agent_id": "investigator-195323-d9a5b1", "finding_type": "insight", "severity": "high", "message": "Schema mapping confirmed via live Supabase read: component_parameters (base table), component_parameter_definitions (names), machine_components (machine + component), process_data_points (parameter_id FK). component_parameters_full is a denormalized view with machine_id, parameter_name, component_name.", "data": {"tables": {"component_parameters": ["id", "component_id", "definition_id", "data_type", "read_modbus_address", "write_modbus_address", "read_modbus_type", "write_modbus_type", "current_value", "set_value", "min_value", "max_value", "is_writable", "show_in_ui", "show_in_graph", "created_at", "updated_at"], "component_parameter_definitions": ["id", "component_definition_id", "name", "unit", "description", "default_min", "default_max", "is_writable", "created_at", "updated_at"], "machine_components": ["id", "machine_id", "name", "type", "definition_id", "is_activated", "is_persistent", "created_at", "updated_at"], "process_data_points": ["id", "process_id", "parameter_id", "value", "set_point", "timestamp", "created_at"]}, "view_component_parameters_full_keys": ["id", "machine_id", "parameter_name", "component_name", "component_type", "machine_serial", "data_type", "read_modbus_address", "write_modbus_address", "read_modbus_type", "write_modbus_type", "current_value", "set_value", "min_value", "max_value", "is_writable", "show_in_ui", "show_in_graph", "created_at", "updated_at"]}}
{"timestamp": "2025-09-20T19:58:28.607821", "agent_id": "investigator-195323-d9a5b1", "finding_type": "insight", "severity": "medium", "message": "Candidate deletion set sized and previewed for MACHINE_ID e3e6e280-0794-459f-84d5-5e468f60746e using component_parameters_full. 24 parameter IDs match the specified patterns; 192 process_data_points rows reference them.", "data": {"machine_id": "e3e6e280-0794-459f-84d5-5e468f60746e", "candidate_ids_count": 24, "referencing_process_data_points_count": 192, "examples": [{"id": "12db5c62-1791-4b52-85e7-491965dc02e9", "parameter_name": "scale_max", "component_name": "MFC 1"}, {"id": "35dc8e4c-06bc-4c0e-adbf-f045c1322f1a", "parameter_name": "scale_max", "component_name": "Pressure Gauge 1"}, {"id": "5090a678-2d53-4bab-bc81-977b47190c51", "parameter_name": "scale_max", "component_name": "Nitrogen Generator"}, {"id": "7f9ede59-32bd-4420-91e1-c5bc7b077faf", "parameter_name": "scale_min", "component_name": "Pressure Gauge 1"}, {"id": "45712c4d-dcc0-46a7-9e16-12c810fa3439", "parameter_name": "scale_min_voltage", "component_name": "Pressure Gauge 1"}, {"id": "9f5387b8-a1b8-4b44-b4a5-be8134e834c5", "parameter_name": "span_cal", "component_name": "Nitrogen Generator"}, {"id": "83b03e5c-ec49-4123-80e6-8043302bbe3d", "parameter_name": "span_cal", "component_name": "MFC 1"}, {"id": "e5001e41-7b4e-4afd-aa78-3f862be12f0a", "parameter_name": "valve_state", "component_name": "Exhaust Gate Valve"}]}}
{"timestamp": "2025-09-20T19:58:42.077153", "agent_id": "investigator-195323-d9a5b1", "finding_type": "recommendation", "severity": "high", "message": "Use component_parameters_full for discovery and base table component_parameters for deletion. Prefer soft-delete first by toggling show_in_ui/show_in_graph to false; if hard-deleting, delete process_data_points for targeted parameter_ids first to avoid FK blocks and orphaned history.", "data": {"discovery_query_examples": {"scale_and_cal": "supabase.table('component_parameters_full').select('id,parameter_name,component_name').eq('machine_id', MACHINE_ID).or_('parameter_name.ilike.scale_min%,parameter_name.ilike.scale_max%,parameter_name.ilike.scale_min_voltage%,parameter_name.ilike.scale_max_voltage%').execute()", "exact_set": "supabase.table('component_parameters_full').select('id').eq('machine_id', MACHINE_ID).in_('parameter_name', ['zero_cal','span_cal','purity','ultrathink']).execute()", "valve_state_non_numbered": "supabase.table('component_parameters_full').select('id,component_name').eq('machine_id', MACHINE_ID).eq('parameter_name','valve_state').filter('component_name','not.ilike','Valve %').execute()"}, "soft_delete_update": "supabase.table('component_parameters').update({'show_in_ui': False, 'show_in_graph': False}).in_('id', candidate_ids).execute()", "hard_delete_order": ["Delete from process_data_points where parameter_id in candidate_ids", "Delete from component_parameters where id in candidate_ids"], "sql_equivalents": {"delete_order": ["DELETE FROM process_data_points WHERE parameter_id IN (:ids);", "DELETE FROM component_parameters WHERE id IN (:ids);"], "single_sql_with_joins": "DELETE FROM component_parameters cp USING machine_components mc, component_parameter_definitions d WHERE cp.component_id = mc.id AND cp.definition_id = d.id AND mc.machine_id = :machine_id AND (d.name ILIKE 'scale_min%' OR d.name ILIKE 'scale_max%' OR d.name ILIKE 'scale_min_voltage%' OR d.name ILIKE 'scale_max_voltage%' OR d.name IN ('zero_cal','span_cal','purity','ultrathink') OR (d.name = 'valve_state' AND mc.name NOT ILIKE 'Valve %'));"}}}
